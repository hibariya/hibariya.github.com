<!DOCTYPE html>
<html>
  <head>
    <title>だいたい合ってるホスト - Hibariya</title>
    <meta charset='utf-8'>
    <meta content='hibariya' name='author'>
    <link href='/favicon-f5e12bf5.png' rel='icon' type='image/png'>
    <link href='/articles.xml' rel='alternate' title='Atom' type='application/atom+xml'>
    <link href="../../stylesheets/application-458a848e.css" rel="stylesheet" type="text/css" media="all" />
    <script src="../../javascripts/application-5ad96b48.js" type="text/javascript"></script>
    <link href='http://note.hibariya.org/articles/20150525/zerigo-api.html' rel='canonical'>
  </head>
  <body class='articles articles_20150525 articles_20150525_zerigo-api'>
    <header>
      <h1>
        <a href="/">Hibariya</a>
      </h1>
      <nav>
        <ul id='menu'>
          <li><a href="/">Home</a></li>
          <li><a href="../../articles.html">Articles</a></li>
          <li><a target="_blank" href="https://github.com/hibariya">Github</a></li>
          <li><a target="_blank" href="https://twitter.com/hibariya">Twitter</a></li>
          <li><a target="_blank" href="https://hibariya.org">hibariya.org</a></li>
        </ul>
      </nav>
    </header>
    <main>
      <article>
        <time>2015-05-25</time>
        <h1><a href="zerigo-api.html">だいたい合ってるホスト</a></h1>
        <p>最近 DNS サービスを Zerigo に変更したところ、REST API もあるらしいということを知る。</p>
        
        <p><a href='https://www.zerigo.com/docs/apis/dns/1.1' target='_blank'>Introduction and Overview | REST API v1.1 | Managed DNS Documentation | Support | Zerigo</a></p>
        
        <p>自宅で常時起動しているマシンにサブドメインを割り振ったけど、たまに IP アドレスが変わるので適当に更新しておいてほしい。急がないけどかんたんに済ませたい。という用途にてっとり早く役立った。</p>
        <pre class="highlight shell"><code><span class="c">#!/bin/sh</span>&#x000A;&#x000A;<span class="c"># 新しいのを教えてもらって</span>&#x000A;<span class="nv">ip_address</span><span class="o">=</span><span class="k">$(</span>&#x000A;  curl <span class="se">\</span>&#x000A;    --basic --user <span class="s2">"</span><span class="k">${</span><span class="nv">ZERIGO_USER_NAME</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">ZERIGO_API_KEY</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>&#x000A;    http://ns.zerigo.com/api/1.1/tools/public_ipv4.xml <span class="se">\</span>&#x000A;    | sed -e <span class="s2">"s/&lt;</span><span class="se">\/\?</span><span class="s2">ipv4&gt;//g"</span>&#x000A;<span class="k">)</span>&#x000A;&#x000A;<span class="c"># それをそのままお返し</span>&#x000A;curl <span class="se">\</span>&#x000A;  --request PUT <span class="se">\</span>&#x000A;  --header <span class="s1">'Content-Type: application/xml'</span> <span class="se">\</span>&#x000A;  --data <span class="s2">"&lt;host&gt;&lt;data&gt;</span><span class="k">${</span><span class="nv">ip_address</span><span class="k">}</span><span class="s2">&lt;/data&gt;&lt;/host&gt;"</span> <span class="se">\</span>&#x000A;  --basic --user <span class="s2">"</span><span class="k">${</span><span class="nv">ZERIGO_USER_NAME</span><span class="k">}</span><span class="s2">:</span><span class="k">${</span><span class="nv">ZERIGO_API_KEY</span><span class="k">}</span><span class="s2">"</span> <span class="se">\</span>&#x000A;  http://ns.zerigo.com/api/1.1/hosts/<span class="k">${</span><span class="nv">HOST_ID</span><span class="k">}</span>.xml&#x000A;</code></pre>
        
        <p><code>HOST_ID</code> の部分を得るために、次の手順で API に問い合わせた。</p>
        
        <ul>
        <li><code>http://ns.zerigo.com/api/1.1/zones.xml</code> で目的のゾーンの ID を探す</li>
        <li><code>http://ns.zerigo.com/api/1.1/zones/[ゾーンのID]/hosts.xml</code> で目的のホストの ID を探す</li>
        </ul>
        
        <p>たまに叩くようにしておけばだいたい合ってる。</p>
      </article>
      <div id='comments'>
        <div id="disqus_thread"></div>
        <script>
          /* * * CONFIGURATION VARIABLES * * */
          var disqus_shortname = 'note-hibariya-org';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </main>
  </body>
</html>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-64572851-1', 'auto');
  ga('send', 'pageview');
</script>

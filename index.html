<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<title>Joy Luck Crab</title>
<link href="./favicon.png" rel="icon" type="image/png">
<link href="./stylesheets/base.css" media="screen" rel="stylesheet" type="text/css">
<link href="./stylesheets/orange.css" media="screen" rel="stylesheet" type="text/css">
<link href="./entries.rss" rel="alternate" title="RSS" type="application/rss+xml">
</head>
<body>
<div id="header">
<h1>
<a href="./index.html">Joy Luck Crab</a>
</h1>
<ul id="menu">
<li>
<a href="./index.html">Home</a>
</li>
<li>
<a href="./profile.html">Profile</a>
</li>
<li>
<a href="./entries.html">Archives</a>
</li>
<li>
<a href="./entries.rss" target="_blank">RSS</a>
</li>
</ul>
</div>
<div id="page">
<div id="content">
<div id="entries">
<article><div class="entry">
<h1 class="date">
<a href="./entries/20111002.html">2011/10/02</a>
</h1>
<h1 id="a0">RETTER (レッター) Flyweight diary workflow.</h1>
<p>手軽さを追求した記事作成ツール。以下のような特徴があります。</p>
<ul>
<li>CLIでの操作を前提としています</li>
<li>どこ（cwd）にいてもすぐに記事を編集できます（Markdown）</li>
<li>オフラインで簡単にプレビューできます</li>
<li>だいたいどんなサーバ上でも動作します（静的HTMLまたはRackアプリとして）</li>
<li>RSSフィードを吐きます</li>
<li>トラックバック、コメントなどの機能はありません</li>
<li>コールバックを設定することでさらに手数を減らすことができます</li>
</ul>
<h2>インストール - Installation</h2>
<p><em>ruby-1.9.2</em> or later is required.</p>
<div class="CodeRay">
  <div class="code"><pre>  gem install retter
</pre></div>
</div>
<h2>使い方 - Usage</h2>
<h3>新規サイト生成 - New site</h3>
<p><code>retter new</code>で新しいサイトのひな形を生成し、依存ライブラリをインストールし、gitリポジトリを初期化します。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter new my_sweet_diary
</pre></div>
</div>
<p>生成するファイルはHAMLテンプレート、設定ファイル、デフォルトのCSS、Rackアプリ用の設定などです。</p>
<h3>初期設定 - Settings</h3>
<h4>$EDITOR</h4>
<p><strong>retter requires <code>$EDITOR</code> variable.</strong>
Retterで記事を編集する際には任意のエディタが起動します。そのためには<code>$EDITOR</code>環境変数が設定されている必要があります。
大抵の場合は設定されていると思いますが、もし設定されていなければ<code>~/.bash_profile</code>や<code>~/.zshenv</code>などに追記する必要があります。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ echo "export EDITOR=vim" &gt;&gt; ~/.bash_profile
  $ . ~/.bash_profile
</pre></div>
</div>
<h4>$RETTER_HOME</h4>
<p>ファイルシステム上のどこに居ても<code>retter</code>コマンドを使って編集から公開まで行えるよう、 事前に<code>$RETTER_HOME</code>環境変数を設定します。</p>
<p>You can use <code>retter</code> command anywhere, If you set <code>$RETTER_HOME</code> variable.</p>
<div class="CodeRay">
  <div class="code"><pre>  $ echo "export RETTER_HOME=/path/to/my_sweet_diary" &gt;&gt; ~/.bash_profile
  $ . ~/.bash_profile
</pre></div>
</div>
<p>作業ディレクトリにRetterfileがある場合は、そのディレクトリが<code>$RETTER_HOME</code>に指定されているものとして動作します。</p>
<h3>記事を書く - Write an article</h3>
<p><code>retter</code>コマンドは設定されているエディタを起動します。今のところMarkdown形式で記事を書くことができます。</p>
<p><code>retter</code> opens <code>$EDITOR</code>. Write an article with Markdown.</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter
</pre></div>
</div>
<p>記事をひと通り書き終えたり確認したくなったら、エディタの機能で記事を保存して終了してください。
保存された記事は、その段階ではまだ下書きの状態です。</p>
<h3>プレビュー - Preview</h3>
<p>下書きの記事を確認するには<code>preview</code>サブコマンドを使います（デフォルトブラウザが起動します）。</p>
<p><code>preview</code> opens the draft article by your default browser.</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter preview
</pre></div>
</div>
<p>気に入らない箇所を見つけたらページを閉じて、また<code>retter</code>コマンドで記事を編集します。
満足のいく文章が出来上がるまで編集とプレビューを繰り返しましょう。</p>
<h3>記事の生成 - Bind</h3>
<p>下書きが完成したら、記事をそのサイトのページとして生成します。
<code>bind</code>, <code>rebind</code> は下書きの記事をその日の記事として保存し、すべてのHTMLを再生成します。</p>
<p><code>bind</code> and <code>rebind</code> binds the draft article. And re-generates actual html web pages. All html pages will be overwritten.</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter bind
</pre></div>
</div>
<h3>サイト全体の確認 - Browse Offline</h3>
<p>生成されるすべてのページは静的HTMLですから、オフラインでも自分のマシンで全体的な見栄えを確認できます。
<code>open</code>サブコマンドはデフォルトブラウザを起動してサイトのトップページを開きます。</p>
<p><code>open</code> sub-command opens your (static) website by your default browser.</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter open
</pre></div>
</div>
<p>デプロイ先のサーバではRackアプリとして起動しているということであれば、rackupで確認しましょう。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter home # `home` opens a new shell in $RETTER_HOME.
  (retter) bundle exec rackup
</pre></div>
</div>
<h3>記事の公開 - Publish</h3>
<p>記事をインターネット上に公開するには、必要なすべてのファイルを git リポジトリにコミットしリモートサーバに push、または単純にファイルをアップロードします。</p>
<p>To publish, use the git command. Or, upload the file to your server.</p>
<h4>Basic flow</h4>
<p>最も原始的な方法は、gitコマンドを直接使う方法です。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ cd $RETTER_HOME
  $ git add .
  $ git commit -m 'commit message'
  $ git push [remote] [branch]     # heroku, github pages, etc..
</pre></div>
</div>
<h4>Using shortcut commands</h4>
<p>いくつかのショートカットを使い、コミットメッセージを書くことを省略したりすることができます。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter commit # Shortcut of `git add . ; git commit -m 'Retter commit'`
  $ retter home   # Open a new shell at $RETTER_HOME
  (retter) git push [remote] [branch] # heroku, github pages, etc..
</pre></div>
</div>
<p>後述するコールバックを設定しておくことで、さらに手数を減らすことも可能です。</p>
<h3>特定の日付の記事を編集する - Edit article (specific date).</h3>
<p>昨日、明日、過去や未来の日付を指定して記事を編集・プレビューするには、 <code>--date</code> オプションを用います。</p>
<p><code>--date</code> option is available in <code>edit</code> <code>preview</code> sub-command.</p>
<div class="CodeRay">
  <div class="code"><pre>  retter edit --date 20110101
  retter preview --date 20110101
</pre></div>
</div>
<h3>コールバック - Callbacks</h3>
<p>コールバックはいくつかのサブコマンド（edit bind rebind commit）の実行直後に自動的に実行されます。
コールバックを定義しておくことで、手数の多い割に代わり映えのしない作業を自動化することができます。</p>
<p>Callback is enabled in <code>edit</code>, <code>bind</code>, <code>rebind</code> and <code>commit</code> sub-command.</p>
<h4>Syntax</h4>
<div class="CodeRay">
  <div class="code"><pre>  after [command], [invoke command <span style="color:#080;font-weight:bold">or</span> proc]
</pre></div>
</div>
<h4>HTMLの生成時、デプロイまでの作業を自動化する - Auto deploying</h4>
<p>以下のような内容を Retterfile に記述しておくことで、rebind または bind が実行されると即座に公開までの処理も実行されます。</p>
<p>In Retterfile:</p>
<div class="CodeRay">
  <div class="code"><pre>  after <span style="color:#A60">:rebind</span>, <span style="color:#A60">:commit</span> <span style="color:#888"># git commit</span>

  after <span style="color:#A60">:commit</span> <span style="color:#080;font-weight:bold">do</span>       <span style="color:#888"># deploy</span>
    system <span style="background-color:#fff0f0;color:#D20"><span style="color:#710">"</span><span style="">cd </span><span style="background:#ddd;color:black"><span style="background:#ddd;font-weight:bold;color:#666">#{</span>config.retter_home<span style="background:#ddd;font-weight:bold;color:#666">}</span></span><span style="color:#710">"</span></span>
    system <span style="background-color:#fff0f0;color:#D20"><span style="color:#710">'</span><span style="">git push origin master</span><span style="color:#710">'</span></span>
  <span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
<p>もし毎回デプロイするのが煩わしい場合は、<code>--silent</code>オプションを付けることでコールバックを回避できます。
その場合は<code>retter rebind</code>ではなく<code>retter rebind --silent</code>を実行することになります。</p>
<p><code>--silent</code> option skip the callback.</p>
<h4>エディタを終了したとき即座にプレビューする - Auto preview</h4>
<p>記事を編集しエディタを終了したあとブラウザでプレビューしたい場合は、<code>edit</code>へのコールバックを設定できます。</p>
<div class="CodeRay">
  <div class="code"><pre>  after <span style="color:#A60">:edit</span> <span style="color:#080;font-weight:bold">do</span>
    preview <span style="color:#080;font-weight:bold">if</span> yes?(<span style="background-color:#fff0f0;color:#D20"><span style="color:#710">"</span><span style="">Preview now? [yes/no]</span><span style="color:#710">"</span></span>)
  <span style="color:#080;font-weight:bold">end</span>
</pre></div>
</div>
<p>もしもコールバックを毎回実行したくない場合、<code>--silent</code>を指定する以外に、上記のようには確認プロンプトを表示させるという方法もあります。</p>
<h3>組込みテーマ - Pre-installed themes</h3>
<p>スタイルシートを変更することでテーマを変更できます。HTMLのヘッダを変更するには <code>layouts/retter.html.haml</code> を編集します。
スタイルシートの指定を変更し、<code>retter rebind</code>コマンドを実行するとすべてのページが更新されます。</p>
<h4>Default</h4>
<div class="CodeRay">
  <div class="code"><pre>    %link{href: '/stylesheets/default.css', media: 'screen', rel: 'stylesheet', type: 'text/css'}
</pre></div>
</div>
<p><img src="http://hibariya.github.com/images/theme_samples/retter_default.jpg" alt="Default"></p>
<h4>Orange</h4>
<div class="CodeRay">
  <div class="code"><pre>    %link{href: '/stylesheets/orange.css', media: 'screen', rel: 'stylesheet', type: 'text/css'}
</pre></div>
</div>
<p><img src="http://hibariya.github.com/images/theme_samples/retter_orange.jpg" alt="Orange"></p>
<h3>HTMLの修正 - HTML Layout</h3>
<p>HTMLのレイアウト自体を変更するには<code>layouts/</code>ディレクトリ以下のHAMLファイルを修正します。
これらのファイルを変更したとしても、<code>retter rebind</code>コマンドを実行するまでは反映されません。</p>
<div class="CodeRay">
  <div class="code"><pre>layouts
  |-- entries.html.haml
  |-- entry.html.haml
  |-- index.html.haml
  |-- profile.html.haml
  `-- retter.html.haml
</pre></div>
</div>
<p><code>retter.html.haml</code>はHTML宣言を含めた全体のHTMLが含まれています。
<code>entry.html.haml</code>を変更することで記事のレイアウトを変更することができます。
その他のファイルは実際のURLと名前が対応しています。</p>
<h2>LICENSE</h2>
<p>The MIT License</p>
<p>Copyright (c) 2011 hibariya</p>
<p>Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files (the "Software"), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is furnished to do so, subject to the following conditions:</p>
<p>The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</p>
<p>THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</p>
</div>
</article><article><div class="entry">
<h1 class="date">
<a href="./entries/20110919.html">2011/09/19</a>
</h1>
<h1 id="a0">スタイルシートを追加してテーマを変えられるようにした</h1>
<p>Retter に <a href="https://github.com/hibariya/retter/commit/f00208e985a5cafd4bbe357f4153a247caf83ab4">Orange という テーマ</a> を作ってもらって、cssの切り替えだけで見た目が変わるようにしてもらった。餅は餅屋だなあ。</p>
</div>
</article><article><div class="entry">
<h1 class="date">
<a href="./entries/20110918.html">2011/09/18</a>
</h1>
<h1 id="a0">ファイルを直接弄るような細かい作業</h1>
<p>作業ディレクトリを一旦クリーンに戻したいような場面。
retterで生成するサイトはgitで管理することを前提にしているせいもあって、直にgitコマンドを実行したい場面がどうしても出てくるみたい。
例えば、<code>git reset</code> したいときとか、<code>git commit --amend</code> したいときとか。</p>
<p>ファイルシステム上のどこに居ようが編集から公開までをできるというメリットはできるだけ殺したくなくて、いちいちリポジトリに移動してgitコマンドを実行するのはちょっと嫌だ。</p>
<p>そこで新たに <code>rette home</code> というコマンドを作ってみた。
<code>home</code> サブコマンドは<code>$RETTER_HOME</code>に移動して新たなシェルを起動する。</p>
<div class="CodeRay">
  <div class="code"><pre>  $ retter home
  (retter) pwd
  /path/to/retter_home
  (retter) exit
  bye
</pre></div>
</div>
<p>これで、いくつものどうでもいい機能の実装を免れるきがする。</p>
<h1 id="a1">直近でやること</h1>
<ol>
<li>書きかけの記事の有無とか、今まで何個記事を書いたかとか表示するサブコマンド（status）がほしい</li>
<li>もっときれいなソースコードが読みたい（リファクタリング）</li>
</ol>
</div>
</article><article><div class="entry">
<h1 class="date">
<a href="./entries/20110916.html">2011/09/16</a>
</h1>
<h1 id="a0">記事公開までの手順を楽にしたい</h1>
<p>今時点でretterを使うとこんな感じの5ステップくらいで記事が公開できるようになる。</p>
<ol>
<li>記事を編集する (retter)</li>
<li>記事を確認する (retter preview)</li>
<li>記事を生成する (retter rebind)</li>
<li>記事をコミットする (retter commit)</li>
<li>記事をデプロイする (cd /path/to/foo &amp;&amp; git push origin master)</li>
</ol>
<p>手順のうち3-5（HTMLの生成から公開まで）は理不尽な手間で、本当は1つにまとめてしまいたい場合が多い。
手順3はいいとして、4と5について説明すると、</p>
<p>手順4はgitを使っているからcommitが必要で、サイト全体をgitで扱えるのは便利なんだけど普段はあまり意識したくない。
手順4を個別にやりたいときっていうのはとっても稀で、だから普段は、普通のソースコードのコミットと違って定期的に機械的にcommitされていれば十分。</p>
<p>手順5は、書く場所と公開する場所が違うせいでデプロイというかアップロードという作業が必要になってる。
これは本当は機械が気をきかせてやってくれるべき気がする。プレビューとかオフラインでの確認機能は用意しているので手順4のHTML生成をしたとき、だいたいは公開する気満々な筈。
ただ稀にだけど、これも個別にやりたいときがある気がする。</p>
<p>ということで、手順の細かさはこのままがいい、でも普段はショートカットしたい、という結論にたどり着いた。そうそう、ショートカット。
HTML生成以降の手順をショートカットした場合の手順を想像してみる。</p>
<ol>
<li>記事を編集する (retter)</li>
<li>記事を確認する (retter preview)</li>
<li>記事を生成・コミット・デプロイする (retter publish)</li>
</ol>
<p>うーん、すっきりした気がする。次はretter publishの実装を考えようかな。やり方を2つ考えてみた。</p>
<ol>
<li>手順3-5を単純にまとめたサブコマンドをひとつ用意する</li>
<li>HTML生成にフックしていろいろできる機能を用意する</li>
</ol>
<p>デプロイ方法としてgitだけではなくてrsyncとかもあり得るなら2がいい。</p>
<h1 id="a1">retter 0.0.3</h1>
<p>それで早速バージョンを上げた。</p>
<p>やったこと:</p>
<ol>
<li>依存しているgemのバージョンを明記するようにした</li>
<li>いくつかのコマンドにフックするコールバックを定義できるようにした</li>
</ol>
<p>コールバックを無効にする --silent オプションを入れるのを忘れていたので次のに入れる。</p>
</div>
</article><article><div class="entry">
<h1 class="date">
<a href="./entries/20110913.html">2011/09/13</a>
</h1>
<h1 id="a0">Pull requestがマージされた</h1>
<p>日曜くらいに送った初の Pull request が今日マージされた。
1行削除するだけの簡単なパッチだったけど。会社のデスクの上で踊りだしそうになってやめた。</p>
<p>今日は、日付は覚えてないけど出来事は覚えている類の特別な日になった。これでやっとひとつ進めるね。
今日は<a href="http://ja.wikipedia.org/wiki/%E3%83%97%E3%83%AD%E3%82%B0%E3%83%A9%E3%83%9E%E3%83%BC%E3%81%AE%E6%97%A5">プログラマの日</a>らしいよ。</p>
<p>思ったこと話すとだいたい嘘になるけど、嘘を話しても本当にならないし際限なく行間が増えていくケチな呪いをかけられている気がする
思ったこと話すと嘘になるけど、嘘を話しても本当にならないしそれどころか際限なく行間だけが増えていくというケチな呪いをかけられている。という注意書きをしておけば、だいたい何を書いても驚き最小の法則でしょうか</p>
</div>
</article><article><div class="entry">
<h1 class="date">
<a href="./entries/20110911.html">2011/09/11</a>
</h1>
<h1 id="a0">Retterというgemをつくった</h1>
<p><a href="https://github.com/hibariya/retter">Retter</a></p>
<p>きちんと日記をつける習慣がないのでどうにかしたくて、出来る限り楽をするための日記生成ツールを作った。
<a href="https://github.com/hibariya/retter">Retter</a> という名前の理由は、片手で打てるから。</p>
<p>日記をつける習慣がうまく根付かない理由のうち、どうにか解決できそうな問題は2つくらいあって、</p>
<ol>
<li>書くことがない</li>
<li>書き始めるまでの心理的な障壁</li>
</ol>
<p>で、1は日記生成ツールを育てるという暫く終わりそうにないテーマが追加されたので一旦解決。
2もこのツールをきちんと育てることで解決できるんじゃないかなあと思った。</p>
<p>このツールの基本的な機能がだいたい出来上がる直前にJekilやOctopressの存在を知ったので、モチベーションが少し下がってきたとこ。</p>
<h1 id="a1">楽に日記を書くために解決できそうなこと</h1>
<p>最低限動くようなところまで開発して、<a href="https://rubygems.org/gems/retter">Gem</a>も公開するところまでの作業はひと通りできた。
当初、楽をするために考えたありったけのわがままは、</p>
<ol>
<li>エディタはターミナルで使い慣れてるやつ(vim)がいい</li>
<li>一瞬で起動して欲しい</li>
<li>どのファイルに書くかとか考えたくない</li>
<li>下書きのままブラウザですぐ確認したい</li>
<li>ローカルでも本番と同じように動いて欲しい</li>
<li>RSSフィードは勝手に吐いて欲しい</li>
<li>気が向いたらrackでも動いて欲しい</li>
<li>サーバに反映するのめんどくさい</li>
</ol>
<p>ひとまず、ここ一週間でなんとなく対応できそうなものに対応してみた。</p>
<ul>
<li>$EDITOR次第で使うエディタが選べるよ</li>
<li>ファイルシステム上のどこに居ようがretterと打つだけで今日の記事を書くファイルが開くよ</li>
<li>デフォルトブラウザですぐ（本番と遜色ない程度に）プレビューできる</li>
<li>サーバ起動したりしなくてもサイト全体をオフラインでかくにんできる</li>
<li>HTMLを生成するときにフィードも勝手に生成する</li>
<li>rackupできるけど静的HTMLだからherokuかgithub pagesにpushするだけで反映できるよ</li>
<li>たとえロリポップでも、ファイルの配置さえできてしまえばきっと動く</li>
<li>gitで管理するから何だか楽しそう</li>
<li>コマンド自体はruby1.9以降なら多分動く。でもWindowsでは多分動かない</li>
</ul>
<p>とりあえず暫く様子をみようかなあ。</p>
<p><a href="https://github.com/hibariya/retter/blob/master/README.md">README</a>の英語がひどいのは十分承知してるんだけど、日本語だけで書かないことで最低限の義務を果たした気分になっています。</p>
</div>
</article>
</div>
</div>
</div>
<div id="footer">
Joy Luck Crab (C) hibariya
Generated by
<a href="https://github.com/hibariya/retter" target="_blank">Retter</a>
</div>
</body>
</html>

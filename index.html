<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<title>Joy Luck Crab</title>
<meta charset="utf-8" content="text/html; charset=UTF-8" http-equiv="Content-Type">
<meta content="hibariya" name="author">
<link href="./favicon.png" rel="icon" type="image/png">
<link href="./stylesheets/base.css" media="screen" rel="stylesheet" type="text/css">
<link href="./stylesheets/orange.css" media="screen" rel="stylesheet" type="text/css">
<link href="./stylesheets/pygments.css" media="screen" rel="stylesheet" type="text/css">
<link href="./entries.rss" rel="alternate" title="RSS" type="application/rss+xml">
<link href="http://coderwall.com/stylesheets/jquery.coderwall.css" media="all" rel="stylesheet" type="text/css">
<script src="./javascripts/jquery.js"></script><script src="http://coderwall.com/javascripts/jquery.coderwall.js"></script>
</head>
<body>
<header id="header"><h1>
<a href="./index.html">Joy Luck Crab</a>
</h1>
<nav><ul id="menu">
<li>
<a href="./index.html">Home</a>
</li>
<li>
<a href="./profile.html">Profile</a>
</li>
<li>
<a href="./entries.html">Archives</a>
</li>
<li>
<a href="./entries.rss" target="_blank">RSS</a>
</li>
</ul></nav></header><div id="page">
<div id="content">
<div class="autopagerize_page_element" id="entries">
<article class="article"><h1 class="date">
<a href="./entries/20120830.html">2012-08-30</a>
</h1>
<h1 id="a0">
<a href="./entries/20120830/a0.html">map が返す Enumerator のこと</a>
</h1>
<p>Enumerable が提供する色々なメソッドは、受け取る筈のブロックが与えられなかった場合 Enumerator オブジェクトを返す。
Enumerator オブジェクトは、<code>each.with_index.with_object</code>みたいに each にブロックを渡さずに使うとかいうのにたまに使う。
あとは、外部イテレータのために使ったり、each 以外のメソッドを使って Enumerable のメソッドを使ったりするのに使える。</p>
<p>each 以外の繰り返しを行うメソッドも、ブロックを受け取らなかったときは Enumerator オブジェクトを返したりする。Enumerable#map とか。</p>
<div class="highlight">
<pre><span class="sx">%w(a b c)</span><span class="o">.</span><span class="n">map</span> <span class="c1"># =&gt; #&lt;Enumerator: ["a", "b", "c"]:map&gt;</span>
</pre>
</div>
<p>これを外部イテレータとして使う機会は今のところない。
（※元々「何に使うの」くらいに書いてたけど、<code>map.with_index</code>はやるよねというツッコミが。たしかに）</p>
<p>使う場面は無くてもせめて使い方くらいは知っておきたいなあと思って Asakusa.rb で人に聞いたりソースに書かれたコメントを読んだりしたら何となく使い方が分かってきた。</p>
<p>疑問はふたつあった。</p>
<ul>
<li>ブロックの戻り値にあたる値はどこにどうやって渡せばいいのか</li>
<li>どうすればメソッドの戻り値を得られるのか</li>
</ul>
<p>それぞれ以下のような感じ。</p>
<ul>
<li>ブロックの戻り値（つまりyieldの戻り値になる値）は Enumerator#feed に渡す</li>
<li>メソッドの戻り値は StopIteration#result から得られる</li>
</ul>
<p>もっとも、↓だけでは何だかありがたみが分からないけど。</p>
<div class="highlight">
<pre><span class="n">ary</span>  <span class="o">=</span> <span class="sx">%w(alice bob carol)</span>
<span class="n">enum</span> <span class="o">=</span> <span class="n">ary</span><span class="o">.</span><span class="n">map</span>

<span class="k">while</span> <span class="kp">true</span>
  <span class="k">begin</span>
    <span class="n">val</span> <span class="o">=</span> <span class="n">enum</span><span class="o">.</span><span class="n">next</span> <span class="c1"># ブロック引数的なもの</span>

    <span class="n">enum</span><span class="o">.</span><span class="n">feed</span> <span class="n">val</span><span class="o">.</span><span class="n">upcase</span> <span class="c1"># ブロックの戻り値的なもの</span>
  <span class="k">rescue</span> <span class="no">StopIteration</span> <span class="o">=&gt;</span> <span class="n">e</span>
    <span class="nb">p</span> <span class="n">e</span><span class="o">.</span><span class="n">result</span> <span class="c1"># ["ALICE", "BOB", "CAROL"] と表示</span>

    <span class="k">break</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
<p>while じゃなくて Kernel.#loop を使うと StopIteration を捕まえてループから脱出してくれたりする。</p>
</article><article class="article"><h1 class="date">
<a href="./entries/20120731.html">2012-07-31</a>
</h1>
<h1 id="a0">
<a href="./entries/20120731/a0.html">簡単に Ruby のリファレンス・マニュアルを開く ruremai を色々直した</a>
</h1>
<p>気がついたら色々な人から良い感じのパッチをもらったので取り込んで <a href="https://rubygems.org/gems/ruremai">0.0.3</a> をリリースしました。</p>
<p><a href="https://github.com/hibariya/ruremai">Ruremai</a> はirbなどを使っている際に、メソッドのリファレンス・マニュアルをお手軽にブラウザで開くためのツールです。
<code>require 'ruremai'</code> すると、Method#rurema! が追加されます。</p>
<p>例えば、「何かそれっぽいメソッドが記憶の片隅にあるんだけど、使い方がイマイチ思い出せない」ようなときに便利。</p>
<div class="highlight">
<pre>hibariya@ ;-) irb
&gt;&gt; require 'ruremai'
=&gt; false
&gt;&gt; ary = %w(alice bob carol)
=&gt; ["alice", "bob", "carol"]
&gt;&gt; ary.method(:any?).rurema! # ここで唐突にブラウザが開く!
</pre>
</div>
<p>今回はいくつかの修正や機能追加があったのでした。</p>
<ul>
<li><a href="https://github.com/hibariya/ruremai/pull/1">ショートカット Object#mean? の追加</a></li>
<li><a href="https://github.com/hibariya/ruremai/pull/2">大文字を含むメソッド名に対応できていなかったバグの修正</a></li>
<li><a href="https://github.com/hibariya/ruremai/pull/4">名前空間や特定のメソッドに対応できていなかったバグの修正と高速化</a></li>
</ul>
<p>自分では気づかないようなバグへのパッチとか、あったら良さそうな機能がどんどん送られくる GitHub とっても便利。</p>
</article><article class="article"><h1 class="date">
<a href="./entries/20120723.html">2012-07-23</a>
</h1>
<h1 id="a0">
<a href="./entries/20120723/a0.html">簡単に Ruby のリファレンス・マニュアルを開く ruremai をつくった</a>
</h1>
<p>Ruby リファレンスマニュアル、通称るりまを開くのが日頃から割と面倒だったので、irb からさっと開けるようなものを作った。</p>
<p><a href="https://github.com/hibariya/ruremai">ruremai</a></p>
<p>require すると Method#rurema! が追加される。これを呼び出すと、るりまの該当メソッドのページをブラウザで開く。</p>
<div class="highlight">
<pre>  <span class="no">Object</span><span class="o">.</span><span class="n">method</span><span class="p">(</span><span class="ss">:name</span><span class="p">)</span><span class="o">.</span><span class="n">rurema!</span>
</pre>
</div>
<p>APIDock とかも見るようにできるといいのかな。</p>
<p><code>~/.irbrc</code> あたりで <code>require 'ruremai'</code> しておくとよさそう。勉強などのお供に。</p>
</article><article class="article"><h1 class="date">
<a href="./entries/20120602.html">2012-06-02</a>
</h1>
<h1 id="a0">
<a href="./entries/20120602/a0.html">社内で code についての発表をした</a>
</h1>
<p><a href="https://twitter.com/koic">@koic</a>先輩に「新卒向けにライブラリやツールを作ることについての話をしてよ」と言われたので二つ返事で受けさせてもらったのだった。</p>
<p><a href="https://speakerdeck.com/u/hibariya/p/code">自分のための code を書こう</a></p>
<p>永和に転職して暫く経ったある日、金曜の夜、飲み屋「ボヤキ」で<a href="https://twitter.com/koic">@koic</a>さんに言われた言葉がぼんやりと印象に残ってる。大体だけど↓のような感じ。</p>
<p>「hibariya は <a href="https://github.com/amatsuda/kaminari">Kaminari</a> の Contributors に入ってると思ってたけど違ったからびっくりした」</p>
<p>そう言われたからといっていきなり Kaminari にパッチを送れるほどの行動力はないのだけど、普段から code を読み書きしている人とそうでない人の間にある、防弾ガラスみたいな、見えないけどはっきりした差を意識し始めるきっかけになった。</p>
<p>発表は、自分の中でいい棚卸になった。</p>
</article><article class="article"><h1 class="date">
<a href="./entries/20120505.html">2012-05-05</a>
</h1>
<h1 id="a0">
<a href="./entries/20120505/a0.html">cline-0.3.0</a>
</h1>
<p>いくつか便利そうな機能をつけて<a href="http://rubygems.org/gems/cline">アップデート</a>しました。</p>
<ul>
<li>簡単にURLを開く機能</li>
<li>フィルタリングのためのインターフェース</li>
</ul>
<h2>簡単にURLを開く</h2>
<p>表示するときにメッセージにエイリアスをつけるようにしました。
その分、あまり必要なさそうな時間の秒とタイムゾーンを表示しないようにしました。</p>
<div class="highlight">
<pre>[2012/05/04 22:41][2][1f5] Delicious.com - Discover Yourself! http://delicious.com/help/quicktour/chrome
                       ↑
                      これ
</pre>
</div>
<p>エイリアスを使うと簡単にメッセージの中のURLをブラウザで開くことができます。
URLが途中で見切れてしまっても大丈夫。</p>
<div class="highlight">
<pre>  $ cline open 1f5
</pre>
</div>
<p>打つのが面倒なので <code>alias co='cline open'</code> しておくとよさそう。</p>
<h3>フィルタリング</h3>
<p>フィルタリングのようなことを、ActiveRecordのvalidationを使って実現できるようにしておきました。
invalidなメッセージは保存されなくなります。
<code>~/.cline/config</code> あたりに書いておくとよさそう。</p>
<div class="highlight">
<pre><span class="nb">require</span> <span class="s1">'hiwai'</span>

<span class="k">class</span> <span class="nc">Cline</span><span class="o">::</span><span class="no">Notification</span>
  <span class="n">validate</span> <span class="ss">:message_should_not_be_hiwai</span>

  <span class="k">def</span> <span class="nf">message_should_not_be_hiwai</span>
    <span class="n">errors</span><span class="o">.</span><span class="n">add</span> <span class="ss">:message</span><span class="p">,</span> <span class="s1">'hiwai'</span> <span class="k">if</span> <span class="n">message</span><span class="o">.</span><span class="n">hiwai?</span>
  <span class="k">end</span>
<span class="k">end</span>
</pre>
</div>
<p>クラスを再オープンしているのだけど、もうちょっとスマートなAPIを用意したいなと思っているところ。
ちなみに<a href="https://github.com/hibariya/hiwai">hiwai</a>はレシーバがひわいかどうかを確認するためのライブラリです。</p>
</article><div class="nav">
<div class="next">
<link href="./entries/20120411.html" rel="next">
</div>
</div>
<div class="autopagerize_insert_before"></div>
</div>
</div>
<aside id="sidebar"><h3>Author</h3>
<div class="author">
<a href="./profile.html">hibariya</a>
</div>
<h3>Recent entries</h3>
<div class="recent-entries">
<ul>
<li>
<a href="./entries/20120830/a0.html">map が返す Enumerator のこと</a>
</li>
<li>
<a href="./entries/20120731/a0.html">簡単に Ruby のリファレンス・マニュアルを開く ruremai を色々直した</a>
</li>
<li>
<a href="./entries/20120723/a0.html">簡単に Ruby のリファレンス・マニュアルを開く ruremai をつくった</a>
</li>
<li>
<a href="./entries/20120602/a0.html">社内で code についての発表をした</a>
</li>
<li>
<a href="./entries/20120505/a0.html">cline-0.3.0</a>
</li>
<li>
<a href="./entries/20120411/a0.html">標準添付ライブラリもエディタで開けるreditorを作った</a>
</li>
</ul>
<div class="archives">
<a href="./entries.html">Archives</a>
</div>
</div>
<h3>Coderwall</h3>
<section class="coderwall" data-coderwall-orientation="horizontal" data-coderwall-username="hibariya"></section></aside>
</div>
<footer id="footer">
Joy Luck Crab (C) hibariya
Generated by
<a href="https://github.com/hibariya/retter" target="_blank">Retter</a>
</footer>
</body>
</html>

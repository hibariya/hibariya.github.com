<!DOCTYPE html>
<html>
  <head>
    <title>pty-shell でシェルを操作する - Hibariya</title>
    <meta charset='utf-8'>
    <meta content='hibariya' name='author'>
    <link href='/favicon-f5e12bf5.png' rel='icon' type='image/png'>
    <link href='/articles.xml' rel='alternate' title='Atom' type='application/atom+xml'>
    <link href="../../stylesheets/application-458a848e.css" rel="stylesheet" type="text/css" media="all" />
    <script src="../../javascripts/application-5ad96b48.js" type="text/javascript"></script>
    <link href='http://note.hibariya.org/articles/20160118/pty-shell.html' rel='canonical'>
  </head>
  <body class='articles articles_20160118 articles_20160118_pty-shell'>
    <header>
      <h1>
        <a href="/">Hibariya</a>
      </h1>
      <nav>
        <ul id='menu'>
          <li><a href="/">Home</a></li>
          <li><a href="../../articles.html">Articles</a></li>
          <li><a target="_blank" href="https://github.com/hibariya">Github</a></li>
          <li><a target="_blank" href="https://twitter.com/hibariya">Twitter</a></li>
          <li><a target="_blank" href="https://hibariya.org">hibariya.org</a></li>
        </ul>
      </nav>
    </header>
    <main>
      <article>
        <time>2016-01-18</time>
        <h1><a href="pty-shell.html">pty-shell でシェルを操作する</a></h1>
        <p>以前、<a href="http://note.hibariya.org/articles/20150628/pty.html">PTY を使ってシェルの入出力を好きなようにする</a> 方法を調べて、それを Rust でやるために <a href="http://note.hibariya.org/articles/20150718/pty-rust-of-us.html">pty という crate を作っ</a> た。この pty を使ってこれまでに <a href="http://github.com/idobata/hokaido">hokaido</a> のようなターミナル共有ツールとか <a href="https://github.com/hibariya/hibariya.org/tree/master/ttybeats">シェルへの入力をどこかへ通知するツール</a> を作った。</p>
        
        <p>これらには「ターミナルを立ち上げてその入出力をフックする」という共通の処理がある。けれど pty が用意している <code>pty::fork()</code> は、新しい疑似端末 (PTY) を割り当てた子プロセスを生成するだけだ。実際には他にも必要な処理がある。</p>
        
        <ul>
        <li>子プロセスの制御端末に適切な画面サイズを設定する。</li>
        <li>標準入力を子プロセスへ即座に伝えるため、親プロセスの制御端末を raw モードにする。</li>
        <li>親プロセスへの入力を子プロセスの標準入力に送り、子プロセスの出力を親プロセスの標準出力に送る。</li>
        <li>子プロセスでシェルを起動する。</li>
        </ul>
        
        <p>意味もなく同じコードを何度も書くのはつらい。とはいえこれら一連の処理は、pty crate として用意するには少し具体的すぎる気がする。そういうわけで、シェルに特化した拡張という意味で pty-shell という crate をもうひとつ用意した。</p>
        
        <p><a href="https://github.com/hibariya/pty-shell">hibariya/pty-shell</a></p>
        
        <p>pty-shell は「ターミナルを立ち上げてその入出力をフックする」ための簡単な方法を提供する。
        具体的には子プロセスとしてシェルを起動し、親プロセスの入出力を子プロセスのシェルにプロキシする。</p>
        
        <script async class="speakerdeck-embed" data-slide="11" data-id="c29a52fffd1f440bbe55ae2bc2bfa54f" data-ratio="1.77777777777778" src="//speakerdeck.com/assets/embed.js"></script>
      </article>
      <div id='comments'>
        <div id="disqus_thread"></div>
        <script>
          /* * * CONFIGURATION VARIABLES * * */
          var disqus_shortname = 'note-hibariya-org';
          
          /* * * DON'T EDIT BELOW THIS LINE * * */
          (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
          })();
        </script>
      </div>
    </main>
  </body>
</html>
<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
  
  ga('create', 'UA-64572851-1', 'auto');
  ga('send', 'pageview');
</script>
